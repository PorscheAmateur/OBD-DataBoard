<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OBD Data Dashboard - Gauges</title>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
        canvas { margin: 20px auto; display: block; }
        .no-data-text { color: red; font-weight: bold; font-size: 1.2em; }
    </style>
</head>
<body>
    <h1>OBD-II Gauge Dashboard</h1>

    <canvas id="rpmGauge" width="300" height="150"></canvas>
    <div id="rpmNoData" class="no-data-text" style="display:none;">No Data</div>

    <canvas id="speedGauge" width="300" height="150"></canvas>
    <div id="speedNoData" class="no-data-text" style="display:none;">No Data</div>

    <canvas id="coolantGauge" width="300" height="150"></canvas>
    <div id="coolantNoData" class="no-data-text" style="display:none;">No Data</div>

    <script>
        const socket = io();

        function createGauge(ctx, label, max) {
            return new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [label, ''],
                    datasets: [{
                        data: [0, max],
                        backgroundColor: ['#4caf50', '#ddd'],
                        borderWidth: 1
                    }]
                },
                options: {
                    rotation: -90,
                    circumference: 180,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false },
                    },
                }
            });
        }

        const rpmChart = createGauge(document.getElementById('rpmGauge'), 'RPM', 8000);
        const speedChart = createGauge(document.getElementById('speedGauge'), 'Speed', 200);
        const coolantChart = createGauge(document.getElementById('coolantGauge'), 'Temp', 120);

        function updateGauge(chart, value, max, noDataId) {
            if (value === "No Data") {
                document.getElementById(noDataId).style.display = 'block';
                chart.data.datasets[0].data[0] = 0;
            } else {
                document.getElementById(noDataId).style.display = 'none';
                chart.data.datasets[0].data[0] = value;
            }
            chart.update();
        }

        socket.on("obd_data", function(data) {
            updateGauge(rpmChart, data.rpm, 8000, 'rpmNoData');
            updateGauge(speedChart, data.speed, 200, 'speedNoData');
            updateGauge(coolantChart, data.coolant_temp, 120, 'coolantNoData');
        });
    </script>
</body>
</html>
