<!DOCTYPE html>
<html>
<head>
    <title>Live OBD-II Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-gauge@1.0.0/dist/chartjs-gauge.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body>
    <h1>ðŸš— Live OBD-II Needle Dashboard</h1>
    <div style="display:flex; flex-wrap: wrap;">
        <canvas id="rpmGauge" width="250" height="250"></canvas>
        <canvas id="speedGauge" width="250" height="250"></canvas>
        <canvas id="coolantGauge" width="250" height="250"></canvas>
        <canvas id="throttleGauge" width="250" height="250"></canvas>
        <canvas id="fuelGauge" width="250" height="250"></canvas>
    </div>

    <script>
        var socket = io();

        function createNeedleGauge(ctx, label, max, warning) {
            return new Chart(ctx, {
                type: 'gauge',
                data: {
                    datasets: [{
                        value: 0,
                        data: [max],
                        backgroundColor: ['green'],
                        borderWidth: 2,
                    }]
                },
                options: {
                    responsive: false,
                    title: {
                        display: true,
                        text: label
                    },
                    layout: {
                        padding: 10
                    },
                    needle: {
                        radiusPercentage: 2,
                        widthPercentage: 3.2,
                        lengthPercentage: 80,
                        color: 'black'
                    },
                    valueLabel: {
                        display: true,
                        formatter: (val) => val.toFixed(1)
                    },
                    plugins: {
                        datalabels: { display: false }
                    }
                }
            });
        }

        // Create gauges
        var rpmGauge = createNeedleGauge(document.getElementById('rpmGauge').getContext('2d'), 'RPM', 8000);
        var speedGauge = createNeedleGauge(document.getElementById('speedGauge').getContext('2d'), 'Speed', 200);
        var coolantGauge = createNeedleGauge(document.getElementById('coolantGauge').getContext('2d'), 'Coolant Â°C', 120);
        var throttleGauge = createNeedleGauge(document.getElementById('throttleGauge').getContext('2d'), 'Throttle %', 100);
        var fuelGauge = createNeedleGauge(document.getElementById('fuelGauge').getContext('2d'), 'Fuel %', 100);

        socket.on('obd_data', function(data) {
            rpmGauge.data.datasets[0].value = data.RPM;
            rpmGauge.update();

            speedGauge.data.datasets[0].value = data.Speed;
            speedGauge.update();

            coolantGauge.data.datasets[0].value = data["Coolant Temp"];
            coolantGauge.update();

            throttleGauge.data.datasets[0].value = data.Throttle;
            throttleGauge.update();

            fuelGauge.data.datasets[0].value = data["Fuel Level"];
            fuelGauge.update();
        });
    </script>
</body>
</html>
